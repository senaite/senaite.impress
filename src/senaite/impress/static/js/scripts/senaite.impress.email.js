!function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=32)}({32:function(e,t,n){"use strict";var i,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();document.addEventListener("DOMContentLoaded",function(){return console.debug("*** SENAITE.IMPRESS::DOMContentLoaded: --\x3e Loading Email Controller"),(new i).initialize()}),i=function(){function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.bind_eventhandler=this.bind_eventhandler.bind(this),this.is_visible=this.is_visible.bind(this),this.toggle_attachments_container=this.toggle_attachments_container.bind(this),this.update_size_info=this.update_size_info.bind(this),this.on_add_attachments_click=this.on_add_attachments_click.bind(this),this.on_attachments_select=this.on_attachments_select.bind(this),this.bind_eventhandler(),this}return a(e,[{key:"initialize",value:function(){return console.debug("BECHEM:Email::initialize"),this.init_overlays()}},{key:"init_overlays",value:function(){return console.debug("BECHEM:Email::init_overlays"),$("a.attachment-link,a.report-link").prepOverlay({subtype:"iframe",config:{closeOnClick:!0,closeOnEsc:!0,onLoad:function(e){return this.getOverlay().find("iframe").css({background:"white"})}}})}},{key:"bind_eventhandler",value:function(){return console.debug("BECHEM:I18N::bind_eventhandler"),$("body").on("click","#add-attachments",this.on_add_attachments_click),$("body").on("change",".attachments input[type='checkbox']",this.on_attachments_select)}},{key:"get_base_url",value:function(){return document.URL.split("?")[0]}},{key:"get_api_url",value:function(e){return this.get_base_url()+"/"+e}},{key:"ajax_fetch",value:function(e,t){var n,i;return i=this.get_api_url(e),null==t&&(t={}),null==t.method&&(t.method="POST"),null==t.credentials&&(t.credentials="include"),null==t.body&&(t.body=null),null==t.header&&(t.header=null),console.info("Email::fetch:endpoint="+e+" init=",t),n=new Request(i,t),fetch(n).then(function(e){return e.json()})}},{key:"is_visible",value:function(e){return"none"!==$(e).css("display")}},{key:"toggle_attachments_container",value:function(){var e,t,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e=$("#add-attachments"),t=$("#additional-attachments-container"),n=this.is_visible(t),null!==i&&(n=!i),!0===n?(t.hide(),e.text("+")):(t.show(),e.text("-"))}},{key:"update_size_info",value:function(e){return e?("kB",$("#attachment-files").text(""+e.files),e.limit_exceeded?($("#email-size").addClass("text-danger"),$("#email-size").text(e.size+" kB > "+e.limit+" kB"),$("input[name='send']").prop("disabled",!0)):($("#email-size").removeClass("text-danger"),$("#email-size").text(e.size+" kB"),$("input[name='send']").prop("disabled",!1))):(console.warn("No valid size information: ",e),null)}},{key:"on_add_attachments_click",value:function(e){return console.debug("°°° Email::on_add_attachments_click"),e.preventDefault(),this.toggle_attachments_container()}},{key:"on_attachments_select",value:function(e){var t,n,i=this;return console.debug("°°° Email::on_attachments_select"),t=$("#send_email_form"),n={body:new FormData(t[0])},this.ajax_fetch("recalculate_size",n).then(function(e){return i.update_size_info(e)})}}]),e}()}});